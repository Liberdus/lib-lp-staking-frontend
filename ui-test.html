<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ UI State Management Test</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    <style>
        .test-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 250px;
        }
        .test-controls h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        .test-controls button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px 12px;
            font-size: 14px;
        }
        .status-indicator {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status-connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <!-- Test Controls -->
    <div class="test-controls">
        <h3>üéØ UI State Test</h3>
        <div id="connection-status" class="status-indicator status-disconnected">
            Status: Disconnected
        </div>
        <button onclick="simulateConnect()">Simulate Connect</button>
        <button onclick="simulateDisconnect()">Simulate Disconnect</button>
        <button onclick="testRealConnection()">Test Real Connection</button>
        <button onclick="checkCurrentState()">Check Current State</button>
        <hr>
        <div style="font-size: 12px; color: #666;">
            <strong>Expected Behavior:</strong><br>
            ‚Ä¢ Connect: Show staking dashboard<br>
            ‚Ä¢ Disconnect: Show welcome message<br>
            ‚Ä¢ Button updates with address
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>Loading LP Staking Platform</h2>
            <p>Initializing wallet connections...</p>
        </div>
    </div>

    <!-- Network Warning -->
    <div id="network-warning" class="network-warning" style="display: none;">
        <div class="container">
            <div class="warning-content">
                <span class="warning-icon">‚ö†Ô∏è</span>
                <span class="warning-text">Please switch to Polygon Amoy Testnet</span>
                <button id="switch-network-btn" class="btn btn-warning btn-small">Switch Network</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>LP Staking</h1>
                    <span class="logo-subtitle">LP Staking</span>
                </div>
                
                <nav class="nav">
                    <a href="#" class="nav-link active">Home</a>
                    <a href="#" class="nav-link">Admin</a>
                </nav>
                
                <div class="header-actions">
                    <button id="theme-toggle" class="btn btn-ghost btn-icon" title="Toggle theme">
                        <span class="theme-icon">üåô</span>
                    </button>
                    <button id="connect-wallet-btn" class="btn btn-primary">
                        <span class="wallet-icon">üëõ</span>
                        <span class="wallet-text">Connect Wallet</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="app-content" class="main-content">
        <!-- Dynamic content will be loaded here -->
        <div class="container">
            <div class="welcome-message">
                <h1>Welcome to LP Staking Platform</h1>
                <p>Connect your wallet to start earning rewards on your liquidity provider tokens.</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>LP Staking</h3>
                    <p>Decentralized liquidity provider token staking platform.</p>
                </div>
                <div class="footer-section">
                    <h4>Links</h4>
                    <ul>
                        <li><a href="#">Documentation</a></li>
                        <li><a href="#">GitHub</a></li>
                        <li><a href="#">Discord</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 LP Staking Platform. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>
    
    <!-- Modal Container -->
    <div id="modal-container" class="modal-container"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        // Verify ethers loaded before continuing
        if (typeof window.ethers === 'undefined') {
            document.body.innerHTML = '<div style="text-align:center;padding:50px;color:red;"><h1>üö® Loading Error</h1><p>Ethers.js failed to load. Please check your internet connection and refresh.</p><button onclick="location.reload()">Refresh Page</button></div>';
            throw new Error('Ethers.js not loaded');
        }
        console.log('‚úÖ Ethers.js loaded successfully');
    </script>
    
    <script src="config/constants.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/core/state.js"></script>
    <script src="js/core/router.js"></script>
    <script src="js/wallet/network-manager.js"></script>
    <script src="js/wallet/wallet-manager.js"></script>
    <script src="js/contracts/contract-manager.js"></script>
    <script src="js/components/base-component.js"></script>
    <script src="js/components/notification.js"></script>
    <script src="js/components/modal.js"></script>
    <script src="js/pages/home.js"></script>
    <script src="js/pages/admin.js"></script>
    <script src="js/core/app.js"></script>

    <script>
        // Test functions for UI state management
        function simulateConnect() {
            console.log('üß™ Simulating wallet connection...');
            
            const mockWalletData = {
                address: '0x1b04567890123456789012345678901234567814',
                walletType: 'metamask',
                chainId: 80002
            };
            
            // Update UI directly
            if (window.app) {
                window.app.updateWalletUI(mockWalletData);
                window.app.updateMainContent(mockWalletData);
                
                // Update status indicator
                const statusEl = document.getElementById('connection-status');
                statusEl.textContent = `Status: Connected (${mockWalletData.address.slice(0, 6)}...${mockWalletData.address.slice(-4)})`;
                statusEl.className = 'status-indicator status-connected';
                
                console.log('‚úÖ Simulated connection successful');
            } else {
                console.error('‚ùå App not initialized');
            }
        }
        
        function simulateDisconnect() {
            console.log('üß™ Simulating wallet disconnection...');
            
            // Update UI directly
            if (window.app) {
                window.app.updateWalletUI(null);
                window.app.updateMainContent(null);
                
                // Update status indicator
                const statusEl = document.getElementById('connection-status');
                statusEl.textContent = 'Status: Disconnected';
                statusEl.className = 'status-indicator status-disconnected';
                
                console.log('‚úÖ Simulated disconnection successful');
            } else {
                console.error('‚ùå App not initialized');
            }
        }
        
        async function testRealConnection() {
            console.log('üß™ Testing real wallet connection...');
            
            if (!window.walletManager) {
                console.error('‚ùå WalletManager not available');
                return;
            }
            
            try {
                if (window.walletManager.isConnected()) {
                    console.log('Wallet already connected, disconnecting...');
                    await window.walletManager.disconnect();
                } else {
                    console.log('Connecting to MetaMask...');
                    await window.walletManager.connectMetaMask();
                }
            } catch (error) {
                console.error('‚ùå Real connection test failed:', error);
            }
        }
        
        function checkCurrentState() {
            console.log('üîç Checking current state...');
            
            const isConnected = window.walletManager?.isConnected();
            const address = window.walletManager?.getAddress();
            const walletType = window.walletManager?.getWalletType();
            
            console.log('Wallet connected:', isConnected);
            console.log('Address:', address);
            console.log('Wallet type:', walletType);
            
            // Check UI elements
            const connectBtn = document.getElementById('connect-wallet-btn');
            const appContent = document.getElementById('app-content');
            
            console.log('Connect button text:', connectBtn?.textContent);
            console.log('App content contains dashboard:', appContent?.innerHTML.includes('staking-dashboard'));
            console.log('App content contains welcome:', appContent?.innerHTML.includes('welcome-message'));
        }
        
        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ UI Test page loaded, initializing app...');
            
            try {
                // Initialize the app
                if (window.App) {
                    window.app = new window.App();
                    await window.app.initialize();
                    console.log('‚úÖ App initialized successfully');
                    
                    // Check initial state
                    setTimeout(checkCurrentState, 1000);
                } else {
                    console.error('‚ùå App class not available');
                }
            } catch (error) {
                console.error('‚ùå App initialization failed:', error);
            }
        });
    </script>
</body>
</html>
