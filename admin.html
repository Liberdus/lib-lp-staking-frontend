<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LP Staking - Admin Panel</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/admin.css">
    
    <!-- Meta Tags -->
    <meta name="description" content="LP Staking Admin Panel - Manage liquidity provider staking contracts">
    <meta name="keywords" content="DeFi, LP Staking, Admin, Blockchain, Ethereum, Polygon">
    <meta name="author" content="LP Staking Protocol">
    
    <!-- Open Graph -->
    <meta property="og:title" content="LP Staking - Admin Panel">
    <meta property="og:description" content="Administrative interface for LP Staking Protocol">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lpstaking.example.com/admin">
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
</head>
<body>
    <!-- Admin Panel Container -->
    <div id="admin-content">
        <!-- Loading state while initializing -->
        <div class="admin-loading">
            <div class="loading-container">
                <div class="loading-spinner"></div>
                <h2>üîê Initializing Admin Panel</h2>
                <p>Verifying administrator privileges...</p>
            </div>
        </div>
    </div>

    <!-- Modal Container (ADDED) -->
    <div id="modal-container" style="display: none;"></div>

    <!-- Error Boundary -->
    <div id="error-boundary" style="display: none;">
        <div class="error-container">
            <h2>‚ùå System Error</h2>
            <p id="error-message">An unexpected error occurred.</p>
            <button class="btn btn-primary" onclick="location.reload()">
                Reload Page
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Configuration (load first) -->
    <script src="js/config/app-config.js"></script>
    <script src="js/config/dev-config.js"></script>

    <!-- Core Libraries with fallbacks -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js" onerror="loadEthersFallback()"></script>
    <script>
        function loadEthersFallback() {
            console.log('Primary ethers CDN failed, trying local fallback...');
            const script = document.createElement('script');
            script.src = 'libs/ethers.umd.min.js';
            script.onerror = () => {
                console.error('‚ùå All ethers sources failed');
                document.getElementById('error-boundary').style.display = 'flex';
                document.getElementById('error-boundary').innerHTML = `
                    <div class="error-container">
                        <h2>‚ùå Critical Error</h2>
                        <p>Ethers.js library failed to load. Please refresh the page or check your internet connection.</p>
                    </div>
                `;
            };
            document.head.appendChild(script);
        }

        // Verify ethers loaded
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (typeof ethers === 'undefined') {
                    console.error('‚ùå Ethers.js not loaded after page load');
                    loadEthersFallback();
                } else {
                    console.log('‚úÖ Ethers.js loaded successfully:', ethers.version);
                }
            }, 1000);
        });
    </script>

    <!-- Core System -->
    <script src="js/utils/logger.js"></script>
    <script src="js/utils/event-manager.js"></script>
    <script src="js/utils/storage-manager.js"></script>
    <script src="js/utils/network-health-check.js"></script>
    <script src="js/core/error-handler.js"></script>
    <script src="js/core/notification-manager.js"></script>
    
    <!-- Wallet Integration -->
    <script src="js/wallet/wallet-manager.js"></script>
    <script src="js/wallet/metamask-connector.js"></script>
    <script src="js/wallet/walletconnect-connector.js"></script>
    
    <!-- Contract System -->
    <script src="js/contracts/contract-manager.js"></script>
    
    <!-- Admin Components -->
    <script src="js/components/admin-page.js"></script>

    <!-- Admin Testing Utility -->
    <script src="js/utils/admin-test.js"></script>

    <!-- Master Initializer -->
    <script src="js/master-initializer.js"></script>

    <script>
        // Debug initialization
        console.log('üîß ADMIN DEBUG: Page scripts loading...');

        // Check dependencies periodically
        let checkCount = 0;
        const maxChecks = 20;

        function checkDependencies() {
            checkCount++;
            console.log(`üîß ADMIN DEBUG: Dependency check ${checkCount}/${maxChecks}`);
            console.log('üîß ADMIN DEBUG: Dependencies status:', {
                ethers: typeof window.ethers !== 'undefined',
                CONFIG: typeof window.CONFIG !== 'undefined',
                contractManager: typeof window.contractManager !== 'undefined',
                adminPage: typeof window.adminPage !== 'undefined'
            });

            if (typeof window.ethers !== 'undefined' &&
                typeof window.CONFIG !== 'undefined') {

                // Try to initialize ContractManager if it doesn't exist
                if (typeof window.contractManager === 'undefined') {
                    console.log('üîß ADMIN DEBUG: Initializing ContractManager...');
                    try {
                        window.contractManager = new ContractManager();
                        console.log('‚úÖ ADMIN DEBUG: ContractManager created');
                    } catch (error) {
                        console.error('‚ùå ADMIN DEBUG: Failed to create ContractManager:', error);
                    }
                }

                if (typeof window.contractManager !== 'undefined') {
                    console.log('‚úÖ ADMIN DEBUG: All dependencies loaded!');
                    return true;
                }
            }

            if (checkCount < maxChecks) {
                setTimeout(checkDependencies, 500);
            } else {
                console.error('‚ùå ADMIN DEBUG: Dependencies failed to load after 10 seconds');
            }
            return false;
        }

        // Start checking after a short delay
        setTimeout(checkDependencies, 1000);

        // Prevent duplicate script loading and initialization
        if (window.adminPanelLoaded) {
            console.log('‚ö†Ô∏è Admin panel already loaded, skipping initialization');
        } else {
            window.adminPanelLoaded = true;
            console.log('üîê Admin panel scripts loading...');
        }

        // Global error handler
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            showErrorBoundary(event.error.message);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            showErrorBoundary(event.reason.message || 'Promise rejection');
        });

        function showErrorBoundary(message) {
            document.getElementById('admin-content').style.display = 'none';
            document.getElementById('error-boundary').style.display = 'flex';
            document.getElementById('error-message').textContent = message;
        }

        // Admin Panel Initialization
        let adminPage = null;

        async function initializeAdminPanel() {
            try {
                console.log('üöÄ Starting Admin Panel initialization...');

                // Debug: Check what's available
                console.log('üîç System check:');
                console.log('  - ethers:', !!window.ethers);
                console.log('  - WalletManager class:', !!window.WalletManager);
                console.log('  - walletManager instance:', !!window.walletManager);
                console.log('  - masterInitializer:', !!window.masterInitializer);
                console.log('  - AdminPage class:', !!window.AdminPage);

                // ENHANCED: More flexible initialization with timeout
                try {
                    if (!window.masterInitializer) {
                        console.log('‚è≥ Waiting for master initializer...');
                        await waitForMasterInitializer(15000); // Shorter timeout
                    }

                    // Initialize master system
                    if (window.masterInitializer && !window.masterInitializer.isInitialized) {
                        console.log('üîß Initializing master system...');
                        await window.masterInitializer.init();
                    }
                } catch (initError) {
                    console.warn('‚ö†Ô∏è Master initialization failed, proceeding with basic setup:', initError.message);

                    // Basic fallback initialization
                    if (!window.contractManager && window.ContractManager) {
                        console.log('üîó Creating contract manager directly...');
                        window.contractManager = new ContractManager();
                        await window.contractManager.init();
                    }
                }

                // Debug: Check wallet manager after initialization
                console.log('üîç Post-init check:');
                console.log('  - walletManager:', !!window.walletManager);
                if (window.walletManager) {
                    console.log('  - connectWallet method:', typeof window.walletManager.connectWallet);
                    console.log('  - connectMetaMask method:', typeof window.walletManager.connectMetaMask);
                    console.log('  - isConnected method:', typeof window.walletManager.isConnected);
                }

                // Create admin page instance
                console.log('üîê Creating admin page...');
                adminPage = new AdminPage();

                // Make globally accessible
                window.adminPage = adminPage;

                console.log('‚úÖ Admin Panel initialization complete');

            } catch (error) {
                console.error('‚ùå Admin Panel initialization failed:', error);
                showErrorBoundary(`Initialization failed: ${error.message}`);
            }
        }

        function waitForMasterInitializer(timeout = 30000) {
            return new Promise((resolve, reject) => {
                const startTime = Date.now();
                
                const checkInitializer = () => {
                    if (window.masterInitializer) {
                        resolve();
                    } else if (Date.now() - startTime > timeout) {
                        reject(new Error('Master initializer timeout'));
                    } else {
                        setTimeout(checkInitializer, 100);
                    }
                };
                
                checkInitializer();
            });
        }

        // Connect wallet function for admin access (CORS-free approach)
        async function connectWallet() {
            try {
                console.log('üîó Attempting wallet connection...');

                // Direct MetaMask connection (bypasses wallet manager issues)
                if (!window.ethereum) {
                    throw new Error('MetaMask not installed. Please install MetaMask to continue.');
                }

                console.log('ü¶ä Connecting directly to MetaMask...');

                // Request account access
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                if (!accounts || accounts.length === 0) {
                    throw new Error('No accounts found. Please unlock MetaMask.');
                }

                // Create provider and signer
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                const address = await signer.getAddress();
                const network = await provider.getNetwork();

                console.log('‚úÖ Wallet connected successfully');
                console.log('üìç Address:', address);
                console.log('üåê Network:', network.chainId);

                // Store connection info globally
                window.walletConnection = {
                    provider,
                    signer,
                    address,
                    network,
                    isConnected: true
                };

                // Update wallet manager if available
                if (window.walletManager) {
                    window.walletManager.provider = provider;
                    window.walletManager.signer = signer;
                    window.walletManager.address = address;
                    window.walletManager.chainId = network.chainId;
                    console.log('üîÑ Updated wallet manager with connection info');
                }

                // Wait a moment for state to update
                await new Promise(resolve => setTimeout(resolve, 500));

                // Reinitialize admin panel after wallet connection
                if (adminPage) {
                    console.log('üîÑ Reinitializing admin panel...');
                    await adminPage.init();
                } else {
                    console.log('‚ö†Ô∏è Admin page not available, reloading...');
                    location.reload();
                }

            } catch (error) {
                console.error('‚ùå Wallet connection failed:', error);

                // Show user-friendly error message
                let errorMessage;
                if (error.message.includes('User rejected') || error.message.includes('User denied')) {
                    errorMessage = 'Wallet connection was cancelled by user';
                } else if (error.message.includes('not installed')) {
                    errorMessage = 'MetaMask not installed. Please install MetaMask extension.';
                } else if (error.message.includes('No accounts')) {
                    errorMessage = 'Please unlock MetaMask and try again.';
                } else {
                    errorMessage = `Wallet connection failed: ${error.message}`;
                }

                alert(errorMessage);
            }
        }

        // Auto-initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ DOM loaded, waiting for system initialization...');
            // Wait a bit for master initializer to complete
            setTimeout(() => {
                console.log('üîê Starting admin panel initialization...');
                initializeAdminPanel();
            }, 3000); // Give master initializer time to complete
        });

        // Network switcher function
        window.switchToPolygonAmoy = async function() {
            console.log('üîÑ Switching to Polygon Amoy...');

            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x13882' }], // 80002 in hex
                });
                console.log('‚úÖ Switched to Polygon Amoy');
                setTimeout(() => window.location.reload(), 1000);
            } catch (switchError) {
                if (switchError.code === 4902) {
                    // Network not added, add it
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0x13882',
                                chainName: 'Polygon Amoy Testnet',
                                nativeCurrency: {
                                    name: 'MATIC',
                                    symbol: 'MATIC',
                                    decimals: 18
                                },
                                rpcUrls: ['https://rpc-amoy.polygon.technology'],
                                blockExplorerUrls: ['https://amoy.polygonscan.com']
                            }]
                        });
                        console.log('‚úÖ Added and switched to Polygon Amoy');
                        setTimeout(() => window.location.reload(), 1000);
                    } catch (addError) {
                        console.error('‚ùå Failed to add network:', addError);
                        alert('‚ùå Failed to add Polygon Amoy network');
                    }
                } else {
                    console.error('‚ùå Failed to switch network:', switchError);
                    alert('‚ùå Failed to switch to Polygon Amoy');
                }
            }
        };

        // Z-index debugging function
        window.debugZIndex = function() {
            console.log('üîç Z-INDEX DEBUG: Checking all elements with high z-index...');

            const allElements = document.querySelectorAll('*');
            const highZElements = [];

            allElements.forEach(el => {
                const zIndex = window.getComputedStyle(el).zIndex;
                if (zIndex !== 'auto' && parseInt(zIndex) > 100) {
                    highZElements.push({
                        element: el.tagName + (el.id ? '#' + el.id : '') + (el.className ? '.' + el.className.split(' ').join('.') : ''),
                        zIndex: zIndex,
                        position: window.getComputedStyle(el).position
                    });
                }
            });

            console.log('üîç Elements with high z-index:', highZElements);

            // Check modal container specifically
            const modalContainer = document.getElementById('modal-container');
            if (modalContainer) {
                const style = window.getComputedStyle(modalContainer);
                console.log('üîç Modal container styles:', {
                    display: style.display,
                    zIndex: style.zIndex,
                    position: style.position,
                    opacity: style.opacity,
                    visibility: style.visibility
                });
            }
        };

        // Modal button visibility test
        window.testModalButtons = function() {
            console.log('üîç TESTING: Modal button visibility...');

            const modalContainer = document.getElementById('modal-container');
            if (!modalContainer) {
                console.error('‚ùå Modal container not found');
                return;
            }

            const modalFooter = modalContainer.querySelector('.modal-footer');
            const buttons = modalContainer.querySelectorAll('.modal-footer button');

            console.log('üîç Modal footer found:', !!modalFooter);
            console.log('üîç Buttons found:', buttons.length);

            if (modalFooter) {
                const footerStyle = window.getComputedStyle(modalFooter);
                console.log('üîç Modal footer styles:', {
                    display: footerStyle.display,
                    visibility: footerStyle.visibility,
                    opacity: footerStyle.opacity,
                    height: footerStyle.height,
                    position: footerStyle.position
                });
            }

            buttons.forEach((btn, index) => {
                const btnStyle = window.getComputedStyle(btn);
                console.log(`üîç Button ${index + 1}:`, {
                    text: btn.textContent.trim(),
                    display: btnStyle.display,
                    visibility: btnStyle.visibility,
                    opacity: btnStyle.opacity
                });
            });
        };

        // Test all admin modals
        window.testAllModals = function() {
            console.log('üß™ TESTING: All admin modals...');

            // First check if admin interface is loaded
            const adminContainer = document.querySelector('.admin-grid-main');
            if (!adminContainer) {
                console.log('‚ùå Admin interface not loaded yet. Wait a moment and try again.');
                return;
            }

            const modalTypes = [
                'hourly-rate',
                'add-pair',
                'remove-pair',
                'update-weights',
                'change-signer',
                'withdraw-rewards'
            ];

            // Check all buttons exist first
            console.log('üîç Checking button availability...');
            modalTypes.forEach(type => {
                const button = document.querySelector(`[data-modal="${type}"]`);
                console.log(`üîç Button [data-modal="${type}"]:`, button ? '‚úÖ Found' : '‚ùå Not found');
            });

            modalTypes.forEach((type, index) => {
                setTimeout(() => {
                    console.log(`üß™ Testing modal: ${type}`);

                    // Simulate button click
                    const button = document.querySelector(`[data-modal="${type}"]`);
                    if (button) {
                        console.log(`‚úÖ Clicking button for: ${type}`);
                        button.click();

                        setTimeout(() => {
                            const modal = document.getElementById('modal-container');
                            const buttons = modal ? modal.querySelectorAll('.modal-footer button') : [];
                            console.log(`‚úÖ ${type} modal: ${buttons.length} buttons found`);

                            // Log button details
                            buttons.forEach((btn, btnIndex) => {
                                console.log(`  Button ${btnIndex + 1}: "${btn.textContent.trim()}"`);
                            });

                            // Close modal
                            if (modal) {
                                modal.style.display = 'none';
                                modal.innerHTML = '';
                            }
                        }, 800);
                    } else {
                        console.log(`‚ùå Button not found for: ${type}`);
                        // Try alternative selector
                        const altButton = document.querySelector(`.proposal-btn:contains("${type}")`);
                        console.log(`üîç Alternative search result:`, altButton ? '‚úÖ Found' : '‚ùå Not found');
                    }
                }, index * 1500);
            });
        };

        // Test individual modal
        window.testModal = function(modalType) {
            console.log(`üß™ Testing individual modal: ${modalType}`);

            const button = document.querySelector(`[data-modal="${modalType}"]`);
            if (button) {
                console.log(`‚úÖ Found button for: ${modalType}`);
                button.click();

                setTimeout(() => {
                    const modal = document.getElementById('modal-container');
                    const buttons = modal ? modal.querySelectorAll('.modal-footer button') : [];
                    const footer = modal ? modal.querySelector('.modal-footer') : null;

                    console.log(`üìä Modal Results for ${modalType}:`);
                    console.log(`  - Modal container: ${modal ? '‚úÖ Found' : '‚ùå Not found'}`);
                    console.log(`  - Modal footer: ${footer ? '‚úÖ Found' : '‚ùå Not found'}`);
                    console.log(`  - Footer buttons: ${buttons.length}`);

                    if (footer) {
                        const footerStyle = window.getComputedStyle(footer);
                        console.log(`  - Footer display: ${footerStyle.display}`);
                        console.log(`  - Footer visibility: ${footerStyle.visibility}`);
                        console.log(`  - Footer opacity: ${footerStyle.opacity}`);
                    }

                    buttons.forEach((btn, index) => {
                        const btnStyle = window.getComputedStyle(btn);
                        console.log(`  - Button ${index + 1}: "${btn.textContent.trim()}" (display: ${btnStyle.display}, visibility: ${btnStyle.visibility})`);
                    });
                }, 1000);
            } else {
                console.log(`‚ùå Button not found for: ${modalType}`);
                console.log('Available buttons:');
                document.querySelectorAll('.proposal-btn').forEach(btn => {
                    console.log(`  - ${btn.textContent.trim()} [data-modal="${btn.dataset.modal}"]`);
                });
            }
        };

        // Test cancel buttons
        window.testCancelButtons = function() {
            console.log('üß™ Testing cancel button functionality...');

            const modalTypes = ['hourly-rate', 'add-pair', 'remove-pair', 'update-weights', 'change-signer', 'withdraw-rewards'];

            modalTypes.forEach((type, index) => {
                setTimeout(() => {
                    console.log(`üß™ Testing cancel for: ${type}`);

                    // Open modal
                    const button = document.querySelector(`[data-modal="${type}"]`);
                    if (button) {
                        button.click();

                        setTimeout(() => {
                            // Find and test cancel button
                            const modal = document.getElementById('modal-container');
                            const cancelBtn = modal ? modal.querySelector('.btn-secondary, .modal-cancel') : null;

                            if (cancelBtn) {
                                console.log(`‚úÖ Cancel button found for ${type}:`, cancelBtn.textContent.trim());
                                console.log(`  - Classes: ${cancelBtn.className}`);
                                console.log(`  - OnClick: ${cancelBtn.getAttribute('onclick')}`);

                                // Test click
                                cancelBtn.click();

                                setTimeout(() => {
                                    const modalAfter = document.getElementById('modal-container');
                                    const isHidden = !modalAfter || modalAfter.style.display === 'none' || modalAfter.innerHTML === '';
                                    console.log(`  - Cancel worked: ${isHidden ? '‚úÖ YES' : '‚ùå NO'}`);
                                }, 200);
                            } else {
                                console.log(`‚ùå Cancel button not found for: ${type}`);
                            }
                        }, 500);
                    }
                }, index * 2000);
            });
        };

        // Add Polygon Amoy network to MetaMask
        window.addPolygonAmoyNetwork = async function() {
            console.log('üîß Adding Polygon Amoy network to MetaMask...');

            try {
                // First try to switch to existing network
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x13882' }] // 80002 in hex
                });
                console.log('‚úÖ Switched to existing Polygon Amoy network');
            } catch (switchError) {
                // If network doesn't exist, add it
                if (switchError.code === 4902) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0x13882', // 80002 in hex
                                chainName: 'Polygon Amoy Testnet',
                                nativeCurrency: {
                                    name: 'MATIC',
                                    symbol: 'MATIC',
                                    decimals: 18
                                },
                                rpcUrls: [
                                    'https://rpc-amoy.polygon.technology',
                                    'https://polygon-amoy-bor-rpc.publicnode.com'
                                ],
                                blockExplorerUrls: ['https://amoy.polygonscan.com']
                            }]
                        });
                        console.log('‚úÖ Polygon Amoy network added successfully');
                    } catch (addError) {
                        console.error('‚ùå Failed to add Polygon Amoy network:', addError);
                    }
                } else {
                    console.log('‚úÖ Network already exists, switch successful');
                }
            }
        };

        // Switch to Polygon Amoy network
        window.switchToPolygonAmoy = async function() {
            console.log('üîß Switching to Polygon Amoy network...');

            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x13882' }] // 80002 in hex
                });
                console.log('‚úÖ Switched to Polygon Amoy network');
            } catch (error) {
                if (error.code === 4902) {
                    // Network not added, add it first
                    await addPolygonAmoyNetwork();
                } else {
                    console.error('‚ùå Failed to switch network:', error);
                }
            }
        };

        // Debug form validation directly
        window.debugFormValidation = function() {
            console.log('üîß DEBUG: Testing form validation...');

            // Check if modal is open
            const modal = document.getElementById('modal-container');
            console.log('Modal container:', modal);
            console.log('Modal display:', modal ? modal.style.display : 'N/A');
            console.log('Modal innerHTML length:', modal ? modal.innerHTML.length : 0);

            // Check for forms
            const allForms = document.querySelectorAll('form');
            console.log('All forms in document:', allForms.length);
            allForms.forEach((form, index) => {
                console.log(`Form ${index + 1}:`, {
                    id: form.id,
                    classes: form.className,
                    parent: form.parentElement?.tagName,
                    visible: form.offsetParent !== null
                });
            });

            // Try to find add-pair-form specifically
            const addPairForm = document.getElementById('add-pair-form');
            console.log('add-pair-form found:', !!addPairForm);
            if (addPairForm) {
                console.log('Form details:', {
                    id: addPairForm.id,
                    visible: addPairForm.offsetParent !== null,
                    inputs: addPairForm.querySelectorAll('input, select, textarea').length
                });
            }
        };

        // Test form submission directly
        window.testFormSubmission = function() {
            console.log('üîß Testing form submission...');

            // Open add pair modal first
            const addPairBtn = document.querySelector('[data-modal="add-pair"]');
            if (addPairBtn) {
                console.log('Opening add pair modal...');
                addPairBtn.click();

                setTimeout(() => {
                    debugFormValidation();

                    // Try to submit form
                    const form = document.getElementById('add-pair-form');
                    if (form) {
                        console.log('Attempting to submit form...');
                        const submitEvent = new Event('submit', { bubbles: true, cancelable: true });
                        form.dispatchEvent(submitEvent);
                    }
                }, 1000);
            }
        };

        // Test contract function directly
        window.testContractFunction = async function() {
            console.log('üîß Testing contract function directly...');

            try {
                // Get contract manager
                const contractManager = window.contractManager;
                if (!contractManager) {
                    console.error('‚ùå Contract manager not available');
                    return;
                }

                console.log('üîß Contract manager found, testing proposeAddPair...');

                // Test the proposeAddPair function
                const result = await contractManager.proposeAddPair(
                    '0x1234567890123456789012345678901234567890',
                    'TEST/USDC',
                    'Uniswap V3',
                    100,
                    'Test description'
                );

                console.log('‚úÖ Contract function result:', result);

                if (result.success) {
                    console.log('üéâ Mock transaction successful!');
                    console.log('üìã Transaction hash:', result.transactionHash);
                } else {
                    console.log('‚ùå Contract function failed:', result.error);
                }

            } catch (error) {
                console.error('‚ùå Test failed:', error);
            }
        };

        // Debug proposal system
        window.debugProposals = function() {
            console.log('üîß DEBUG: Testing proposal system...');

            if (!window.adminPage) {
                console.error('‚ùå AdminPage not available');
                return;
            }

            console.log('üîß AdminPage found, checking mock proposals...');
            console.log('Mock proposals map:', window.adminPage.mockProposals);
            console.log('Mock proposals size:', window.adminPage.mockProposals.size);

            // Test getMockProposals
            const mockProposals = window.adminPage.getMockProposals();
            console.log('Mock proposals array:', mockProposals);

            // Test loadMockProposals
            const formattedProposals = window.adminPage.loadMockProposals();
            console.log('Formatted proposals:', formattedProposals);

            // Force reload proposals
            console.log('üîß Force reloading proposals...');
            window.adminPage.loadMultiSignPanel();
        };

        // Test mock system initialization
        window.testMockSystem = function() {
            console.log('üîß Testing mock system initialization...');

            if (!window.adminPage) {
                console.error('‚ùå AdminPage not available');
                return;
            }

            // Manually initialize mock system
            window.adminPage.initializeMockSystem();
            console.log('‚úÖ Mock system initialized');

            // Debug the results
            debugProposals();
        };

        // Test ADD PAIR functionality
        window.testAddPair = async function() {
            console.log('üß™ Testing ADD PAIR functionality...');

            if (!window.adminPage) {
                console.error('‚ùå AdminPage not available');
                return;
            }

            try {
                // Get contract manager
                const contractManager = window.contractManager;
                if (!contractManager) {
                    console.error('‚ùå Contract manager not available');
                    return;
                }

                console.log('üîß Contract manager found, testing proposeAddPair...');

                // Test the proposeAddPair function
                const result = await contractManager.proposeAddPair(
                    '0x1234567890123456789012345678901234567890',
                    'TEST/USDC',
                    'Uniswap V3',
                    100
                );

                console.log('‚úÖ Contract function result:', result);

                if (result.success) {
                    console.log('üéâ Proposal creation successful!');
                    console.log('üìã Transaction hash:', result.transactionHash);

                    // Refresh the admin panel to show new proposal
                    await window.adminPage.refreshData();
                    console.log('‚úÖ Admin panel refreshed');
                } else {
                    console.log('‚ùå Contract function failed:', result.error);
                }

            } catch (error) {
                console.error('‚ùå Test failed:', error);
            }
        };

        // Test real contract governance functions
        window.testRealContract = async function() {
            console.log('üß™ Testing REAL CONTRACT governance functions...');

            try {
                const contractManager = window.contractManager;
                if (!contractManager) {
                    console.error('‚ùå Contract manager not available');
                    return;
                }

                console.log('üîß Testing contract functions...');

                // Test 1: Check actionCounter
                try {
                    const actionCounter = await contractManager.stakingContract.actionCounter();
                    console.log('‚úÖ actionCounter:', actionCounter.toString());
                } catch (error) {
                    console.error('‚ùå actionCounter failed:', error.message);
                }

                // Test 2: Check REQUIRED_APPROVALS
                try {
                    const requiredApprovals = await contractManager.stakingContract.REQUIRED_APPROVALS();
                    console.log('‚úÖ REQUIRED_APPROVALS:', requiredApprovals.toString());
                } catch (error) {
                    console.error('‚ùå REQUIRED_APPROVALS failed:', error.message);
                }

                // Test 3: Check if approveAction function exists
                try {
                    const hasApproveAction = typeof contractManager.stakingContract.approveAction === 'function';
                    console.log('‚úÖ approveAction function exists:', hasApproveAction);
                } catch (error) {
                    console.error('‚ùå approveAction check failed:', error.message);
                }

                // Test 4: Check if rejectAction function exists
                try {
                    const hasRejectAction = typeof contractManager.stakingContract.rejectAction === 'function';
                    console.log('‚úÖ rejectAction function exists:', hasRejectAction);
                } catch (error) {
                    console.error('‚ùå rejectAction check failed:', error.message);
                }

                // Test 5: Check if proposeAddPair function exists
                try {
                    const hasProposeAddPair = typeof contractManager.stakingContract.proposeAddPair === 'function';
                    console.log('‚úÖ proposeAddPair function exists:', hasProposeAddPair);
                } catch (error) {
                    console.error('‚ùå proposeAddPair check failed:', error.message);
                }

                console.log('üéâ Real contract test completed!');

            } catch (error) {
                console.error('‚ùå Real contract test failed:', error);
            }
        };

        // Test wallet and signer status
        window.testWalletSigner = async function() {
            console.log('üß™ Testing WALLET AND SIGNER status...');

            try {
                // Test 1: Check wallet manager
                if (window.walletManager) {
                    console.log('‚úÖ Wallet manager exists');
                    console.log('üîç Wallet connected:', window.walletManager.isConnected());
                    console.log('üîç Wallet address:', window.walletManager.getAddress());
                    console.log('üîç Wallet type:', window.walletManager.getWalletType());
                    console.log('üîç Chain ID:', window.walletManager.getChainId());
                } else {
                    console.error('‚ùå Wallet manager not found');
                }

                // Test 2: Check contract manager
                if (window.contractManager) {
                    console.log('‚úÖ Contract manager exists');
                    console.log('üîç Contract manager ready:', window.contractManager.isReady());
                    console.log('üîç Has provider:', !!window.contractManager.provider);
                    console.log('üîç Has signer:', !!window.contractManager.signer);

                    // Test signer
                    if (window.contractManager.signer) {
                        try {
                            const signerAddress = await window.contractManager.signer.getAddress();
                            console.log('‚úÖ Signer address:', signerAddress);
                        } catch (error) {
                            console.error('‚ùå Signer address failed:', error.message);
                        }
                    } else {
                        console.warn('‚ö†Ô∏è No signer available');
                    }
                } else {
                    console.error('‚ùå Contract manager not found');
                }

                // Test 3: Check MetaMask
                if (window.ethereum) {
                    console.log('‚úÖ MetaMask available');
                    try {
                        const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                        console.log('üîç MetaMask accounts:', accounts);
                    } catch (error) {
                        console.error('‚ùå MetaMask accounts failed:', error.message);
                    }
                } else {
                    console.error('‚ùå MetaMask not available');
                }

                console.log('üéâ Wallet/Signer test completed!');

            } catch (error) {
                console.error('‚ùå Wallet/Signer test failed:', error);
            }
        };

        // Force fix signer issue
        window.fixSigner = async function() {
            console.log('üîß FIXING SIGNER ISSUE...');

            try {
                if (!window.contractManager) {
                    console.error('‚ùå Contract manager not found');
                    return;
                }

                // Force get signer from MetaMask
                if (window.ethereum) {
                    console.log('üîß Getting signer from MetaMask...');
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    const signer = provider.getSigner();

                    // Verify signer works
                    const address = await signer.getAddress();
                    console.log('‚úÖ Signer address:', address);

                    // Update contract manager
                    window.contractManager.provider = provider;
                    window.contractManager.signer = signer;

                    // Reinitialize contracts with signer
                    await window.contractManager.initializeContracts();
                    console.log('‚úÖ Contract manager updated with signer');

                    // Test signer again
                    await testWalletSigner();

                } else {
                    console.error('‚ùå MetaMask not available');
                }

            } catch (error) {
                console.error('‚ùå Fix signer failed:', error);
            }
        };

        // Complete system fix
        window.fixEverything = async function() {
            console.log('üîß FIXING ALL SYSTEM ISSUES...');

            try {
                // Step 1: Fix signer
                console.log('üîß Step 1: Fixing signer...');
                await fixSigner();

                // Step 2: Test contract functions
                console.log('üîß Step 2: Testing contract functions...');
                await testRealContract();

                // Step 3: Refresh admin panel
                console.log('üîß Step 3: Refreshing admin panel...');
                if (window.adminPage) {
                    await window.adminPage.refreshData();
                }

                console.log('üéâ SYSTEM FIX COMPLETED!');
                console.log('‚úÖ Try the ADD PAIR button now');

            } catch (error) {
                console.error('‚ùå System fix failed:', error);
            }
        };

        // Test contract signer integration
        window.testContractSigner = async function() {
            console.log('üß™ Testing CONTRACT SIGNER integration...');

            try {
                const contractManager = window.contractManager;
                if (!contractManager) {
                    console.error('‚ùå Contract manager not found');
                    return;
                }

                // Test 1: Check if contracts have signer
                console.log('üîç Staking contract signer:', !!contractManager.stakingContract?.signer);
                console.log('üîç Reward token contract signer:', !!contractManager.rewardTokenContract?.signer);

                // Test 2: Force ensure signer
                console.log('üîß Ensuring signer...');
                await contractManager.ensureSigner();

                // Test 3: Check contracts again
                console.log('üîç After ensureSigner - Staking contract signer:', !!contractManager.stakingContract?.signer);
                console.log('üîç After ensureSigner - Reward token contract signer:', !!contractManager.rewardTokenContract?.signer);

                // Test 4: Try to get signer address from contract
                if (contractManager.stakingContract?.signer) {
                    try {
                        const signerAddress = await contractManager.stakingContract.signer.getAddress();
                        console.log('‚úÖ Contract signer address:', signerAddress);
                    } catch (error) {
                        console.error('‚ùå Contract signer address failed:', error.message);
                    }
                }

                console.log('üéâ Contract signer test completed!');

            } catch (error) {
                console.error('‚ùå Contract signer test failed:', error);
            }
        };

        // Ultimate fix for all signer issues
        window.ultimateSignerFix = async function() {
            console.log('üîß ULTIMATE SIGNER FIX - Fixing all issues...');

            try {
                const contractManager = window.contractManager;
                if (!contractManager) {
                    console.error('‚ùå Contract manager not found');
                    return;
                }

                // Step 1: Force get signer from MetaMask
                console.log('üîß Step 1: Getting signer from MetaMask...');
                if (!window.ethereum) {
                    console.error('‚ùå MetaMask not available');
                    return;
                }

                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();

                // Verify signer works
                const address = await signer.getAddress();
                console.log('‚úÖ Signer address:', address);

                // Step 2: Update contract manager
                console.log('üîß Step 2: Updating contract manager...');
                contractManager.provider = provider;
                contractManager.signer = signer;

                // Step 3: Recreate all contracts with signer
                console.log('üîß Step 3: Recreating contracts with signer...');
                await contractManager.initializeContracts();

                // Step 4: Verify contracts have signer
                console.log('üîß Step 4: Verifying contracts...');
                console.log('‚úÖ Staking contract has signer:', !!contractManager.stakingContract?.signer);
                console.log('‚úÖ Reward token contract has signer:', !!contractManager.rewardTokenContract?.signer);

                // Step 5: Test a simple contract call
                console.log('üîß Step 5: Testing contract call...');
                try {
                    const rewardToken = await contractManager.stakingContract.rewardToken();
                    console.log('‚úÖ Contract call successful, reward token:', rewardToken);
                } catch (error) {
                    console.log('‚ö†Ô∏è Contract call failed (might be network issue):', error.message);
                }

                console.log('üéâ ULTIMATE SIGNER FIX COMPLETED!');
                console.log('‚úÖ Try the ADD PAIR or HOURLY RATE buttons now');

            } catch (error) {
                console.error('‚ùå Ultimate signer fix failed:', error);
            }
        };

        // Test proposal creation with error handling
        window.testProposalCreation = async function() {
            console.log('üß™ Testing PROPOSAL CREATION with error handling...');

            try {
                const contractManager = window.contractManager;
                if (!contractManager) {
                    console.error('‚ùå Contract manager not found');
                    return;
                }

                // Test 1: Test add pair proposal
                console.log('üîß Testing add pair proposal...');
                const addPairResult = await contractManager.proposeAddPair(
                    '0x1234567890123456789012345678901234567890',
                    'TEST/USDC',
                    'Uniswap V3',
                    100,
                    'Test proposal'
                );

                console.log('‚úÖ Add pair result:', addPairResult);

                if (addPairResult.success) {
                    if (addPairResult.isDemo) {
                        console.log('‚úÖ Demo proposal created successfully');
                        console.log('   - Message:', addPairResult.message);
                        console.log('   - Transaction Hash:', addPairResult.transactionHash);
                    } else {
                        console.log('‚úÖ Real proposal created successfully');
                        console.log('   - Transaction Hash:', addPairResult.transactionHash);
                    }
                } else {
                    console.error('‚ùå Add pair proposal failed:', addPairResult.error);
                }

                // Test 2: Test hourly rate proposal
                console.log('üîß Testing hourly rate proposal...');
                const hourlyRateResult = await contractManager.proposeSetHourlyRewardRate(0.1);

                console.log('‚úÖ Hourly rate result:', hourlyRateResult);

                if (hourlyRateResult.success) {
                    if (hourlyRateResult.isDemo) {
                        console.log('‚úÖ Demo hourly rate proposal created successfully');
                        console.log('   - Message:', hourlyRateResult.message);
                        console.log('   - Transaction Hash:', hourlyRateResult.transactionHash);
                    } else {
                        console.log('‚úÖ Real hourly rate proposal created successfully');
                        console.log('   - Transaction Hash:', hourlyRateResult.transactionHash);
                    }
                } else {
                    console.error('‚ùå Hourly rate proposal failed:', hourlyRateResult.error);
                }

                console.log('üéâ Proposal creation test completed!');

            } catch (error) {
                console.error('‚ùå Proposal creation test failed:', error);
            }
        };

        // Complete system test
        window.completeSystemTest = async function() {
            console.log('üß™ COMPLETE SYSTEM TEST - Testing everything...');

            try {
                // Step 1: Test wallet and signer
                console.log('üîß Step 1: Testing wallet and signer...');
                await testWalletSigner();

                // Step 2: Test contract signer integration
                console.log('üîß Step 2: Testing contract signer integration...');
                await testContractSigner();

                // Step 3: Test proposal creation
                console.log('üîß Step 3: Testing proposal creation...');
                await testProposalCreation();

                // Step 4: Test forms
                console.log('üîß Step 4: Forms should now work - try the ADD PAIR and HOURLY RATE buttons!');
                console.log('‚úÖ COMPLETE SYSTEM TEST PASSED!');
                console.log('üéâ The system is ready for demo use!');

            } catch (error) {
                console.error('‚ùå Complete system test failed:', error);
            }
        };

        // Test the actual forms like React version
        window.testFormsLikeReact = async function() {
            console.log('üß™ Testing forms with React-like patterns...');

            try {
                // Test 1: Test hourly rate form
                console.log('üîß Testing hourly rate form...');

                // Fill form fields
                const rateInput = document.getElementById('new-rate');
                const descInput = document.getElementById('rate-description');

                if (rateInput && descInput) {
                    rateInput.value = '0.5';
                    descInput.value = 'Test hourly rate proposal';

                    // Simulate form submission
                    const result = await window.adminPage.submitHourlyRateProposal({preventDefault: () => {}});
                    console.log('‚úÖ Hourly rate form test result:', result);
                } else {
                    console.log('‚ö†Ô∏è Hourly rate form fields not found - open the modal first');
                }

                // Test 2: Test add pair form
                console.log('üîß Testing add pair form...');

                const pairAddressInput = document.getElementById('pair-address');
                const pairNameInput = document.getElementById('pair-name');
                const pairPlatformInput = document.getElementById('pair-platform');
                const pairWeightInput = document.getElementById('pair-weight');
                const pairDescInput = document.getElementById('pair-description');

                if (pairAddressInput && pairNameInput && pairPlatformInput && pairWeightInput) {
                    pairAddressInput.value = '0x1234567890123456789012345678901234567890';
                    pairNameInput.value = 'TEST/USDC';
                    pairPlatformInput.value = 'Uniswap V3';
                    pairWeightInput.value = '100';
                    if (pairDescInput) pairDescInput.value = 'Test add pair proposal';

                    // Simulate form submission
                    const result = await window.adminPage.submitAddPairProposal({preventDefault: () => {}});
                    console.log('‚úÖ Add pair form test result:', result);
                } else {
                    console.log('‚ö†Ô∏è Add pair form fields not found - open the modal first');
                }

                console.log('üéâ Form testing completed!');
                console.log('‚úÖ Both forms should now work without errors');

            } catch (error) {
                console.error('‚ùå Form testing failed:', error);
            }
        };

        // Test proposal loading specifically
        window.testProposalLoading = async function() {
            console.log('üß™ Testing proposal loading like React version...');

            try {
                const contractManager = await window.adminPage.ensureContractReady();

                // Test 1: Get action counter
                console.log('üîß Testing getActionCounter...');
                const actionCounter = await contractManager.getActionCounter();
                console.log('‚úÖ Action counter:', actionCounter);

                // Test 2: Try to get actions (like React version)
                console.log('üîß Testing getAction calls...');
                for (let i = actionCounter; i >= Math.max(1, actionCounter - 5); i--) {
                    console.log(`üîß Testing getAction(${i})...`);
                    const action = await contractManager.getAction(i);
                    if (action) {
                        console.log(`‚úÖ Action ${i}:`, {
                            actionType: action.actionType,
                            executed: action.executed,
                            approvals: action.approvals
                        });
                    } else {
                        console.log(`‚ö†Ô∏è Action ${i}: null (gracefully handled)`);
                    }
                }

                // Test 3: Load proposals through admin page
                console.log('üîß Testing loadProposals...');
                const proposals = await window.adminPage.loadProposals();
                console.log('‚úÖ Loaded proposals:', proposals.length);
                proposals.forEach(p => {
                    console.log(`  - Proposal ${p.id}: ${p.actionType} (${p.approvals}/${p.requiredApprovals} approvals)`);
                });

                // Test 4: Check if proposals show in UI
                console.log('üîß Checking UI display...');
                const proposalRows = document.querySelectorAll('.proposal-row');
                console.log(`‚úÖ Found ${proposalRows.length} proposal rows in UI`);

                console.log('üéâ Proposal loading test completed!');

            } catch (error) {
                console.error('‚ùå Proposal loading test failed:', error);
            }
        };

        // Test RPC health and fallback system
        window.testRpcHealthAndFallbacks = async function() {
            console.log('üß™ Testing RPC health and fallback system...');

            try {
                const contractManager = await window.adminPage.ensureContractReady();

                // Test 1: Check RPC health
                console.log('üîß Testing RPC health check...');
                const isRpcDown = await window.adminPage.checkRpcHealth(contractManager);
                console.log('‚úÖ RPC health check result:', isRpcDown ? 'DOWN (using fallbacks)' : 'HEALTHY');

                // Test 2: Test safe contract calls
                console.log('üîß Testing safe contract calls...');
                const rewardToken = await window.adminPage.safeContractCall(
                    () => contractManager.stakingContract.rewardToken(),
                    'FALLBACK_TOKEN'
                );
                console.log('‚úÖ Safe rewardToken call:', rewardToken);

                const actionCounter = await window.adminPage.safeContractCall(
                    () => contractManager.stakingContract.actionCounter(),
                    999
                );
                console.log('‚úÖ Safe actionCounter call:', actionCounter);

                // Test 3: Test demo proposals
                console.log('üîß Testing demo proposals...');
                const demoProposals = window.adminPage.createDemoProposals();
                console.log('‚úÖ Demo proposals created:', demoProposals.length);
                demoProposals.forEach(p => {
                    console.log(`  - Demo Proposal ${p.id}: ${p.actionType} (${p.approvals}/${p.requiredApprovals} approvals)`);
                });

                // Test 4: Test contract stats loading
                console.log('üîß Testing contract stats loading...');
                await window.adminPage.loadContractStats();
                console.log('‚úÖ Contract stats loaded with fallbacks');

                // Test 5: Test proposal loading
                console.log('üîß Testing proposal loading with fallbacks...');
                const proposals = await window.adminPage.loadProposals();
                console.log('‚úÖ Proposals loaded:', proposals.length);
                proposals.forEach(p => {
                    console.log(`  - Proposal ${p.id}: ${p.actionType} (${p.approvals}/${p.requiredApprovals} approvals)`);
                });

                console.log('üéâ RPC health and fallback test completed!');
                console.log('‚úÖ System handles RPC issues gracefully like React version');

            } catch (error) {
                console.error('‚ùå RPC health test failed:', error);
            }
        };

        // Test the complete admin panel with fallbacks
        window.testAdminPanelWithFallbacks = async function() {
            console.log('üß™ Testing complete admin panel with fallbacks...');

            try {
                // Test 1: Load contract stats
                console.log('üîß Testing contract stats loading...');
                await window.adminPage.loadContractStats();
                console.log('‚úÖ Contract stats loaded');

                // Test 2: Load proposals with fallbacks
                console.log('üîß Testing proposal loading with fallbacks...');
                const proposals = await window.adminPage.loadProposals();
                console.log('‚úÖ Proposals loaded:', proposals.length);

                if (proposals.length === 0) {
                    console.log('‚ö†Ô∏è No real proposals loaded, forcing demo proposals...');
                    const demoProposals = window.adminPage.createDemoProposals();
                    console.log('‚úÖ Demo proposals created:', demoProposals.length);

                    // Manually display demo proposals
                    window.adminPage.displayProposals(demoProposals);
                    console.log('‚úÖ Demo proposals displayed in UI');
                }

                // Test 3: Check UI elements
                console.log('üîß Checking UI elements...');
                const proposalRows = document.querySelectorAll('.proposal-row, .proposal-item');
                console.log(`‚úÖ Found ${proposalRows.length} proposal elements in UI`);

                const approveButtons = document.querySelectorAll('[data-action="approve"], .approve-btn');
                const rejectButtons = document.querySelectorAll('[data-action="reject"], .reject-btn');
                console.log(`‚úÖ Found ${approveButtons.length} approve buttons and ${rejectButtons.length} reject buttons`);

                console.log('üéâ Admin panel test completed!');
                console.log('‚úÖ System shows proposals even when contract calls fail');

            } catch (error) {
                console.error('‚ùå Admin panel test failed:', error);
            }
        };

        // Emergency modal test function
        window.testEmergencyModal = function() {
            console.log('üß™ EMERGENCY: Testing modal system...');

            const modalContainer = document.getElementById('modal-container');
            if (!modalContainer) {
                console.error('‚ùå EMERGENCY: Modal container not found!');
                alert('‚ùå Modal container not found!');
                return;
            }

            console.log('‚úÖ EMERGENCY: Modal container found');

            modalContainer.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 255, 0, 0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 99999;
                " onclick="document.getElementById('modal-container').style.display='none'; document.getElementById('modal-container').innerHTML='';">
                    <div style="
                        background: white;
                        padding: 30px;
                        border-radius: 10px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                        max-width: 500px;
                        width: 90%;
                        text-align: center;
                        color: black;
                        font-family: Arial, sans-serif;
                    " onclick="event.stopPropagation();">
                        <h2 style="color: #28a745; margin-bottom: 20px;">üß™ EMERGENCY MODAL TEST</h2>
                        <p style="margin-bottom: 20px;">If you can see this modal, the modal system is working!</p>
                        <p style="margin-bottom: 20px; color: #666;">This means the issue is with the admin modal HTML or CSS.</p>
                        <button onclick="document.getElementById('modal-container').style.display='none'; document.getElementById('modal-container').innerHTML='';"
                                style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                            Close Test Modal
                        </button>
                    </div>
                </div>
            `;

            modalContainer.style.display = 'flex';
            console.log('‚úÖ EMERGENCY: Test modal displayed');
        };

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (adminPage) {
                adminPage.destroy();
            }
        });
    </script>

    <style>
        /* Loading styles for initial state */
        .admin-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
        }

        .loading-container {
            text-align: center;
            padding: 40px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00d4ff;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 20px;
        }

        .loading-container h2 {
            margin: 0 0 10px 0;
            font-size: 24px;
            font-weight: 600;
            color: #ffffff;
        }

        .loading-container p {
            margin: 0;
            color: #a0a0a0;
            font-size: 16px;
        }

        .error-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            text-align: center;
            padding: 40px;
        }

        .error-container h2 {
            margin: 0 0 15px 0;
            color: #ff6b6b;
            font-size: 24px;
        }

        .error-container p {
            margin: 0 0 25px 0;
            color: #a0a0a0;
            max-width: 500px;
            line-height: 1.6;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #error-boundary {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
        }
    </style>
</body>
</html>
