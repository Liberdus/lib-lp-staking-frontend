<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 3 Implementation Validation Test</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/component-library.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-6);
        }
        
        .test-section {
            margin-bottom: var(--space-8);
            padding: var(--space-6);
            background-color: var(--background-secondary);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-primary);
        }
        
        .test-title {
            color: var(--primary-color);
            margin-bottom: var(--space-4);
            font-size: var(--font-size-xl);
            font-weight: 600;
        }
        
        .test-result {
            padding: var(--space-3);
            margin: var(--space-2) 0;
            border-radius: var(--border-radius);
            font-family: var(--font-mono);
            font-size: var(--font-size-sm);
        }
        
        .test-pass {
            background-color: var(--success-color);
            color: white;
        }
        
        .test-fail {
            background-color: var(--error-color);
            color: white;
        }
        
        .test-info {
            background-color: var(--info-color);
            color: white;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-4);
            margin: var(--space-4) 0;
        }
        
        .demo-card {
            padding: var(--space-4);
            background-color: var(--background-primary);
            border: 1px solid var(--border-primary);
            border-radius: var(--border-radius);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-3);
            margin: var(--space-4) 0;
        }
        
        .stat-card {
            padding: var(--space-3);
            background-color: var(--background-primary);
            border: 1px solid var(--border-primary);
            border-radius: var(--border-radius);
            text-align: center;
        }
        
        .stat-value {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-top: var(--space-1);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="text-center mb-5">Day 3 Implementation Validation Test</h1>
        
        <!-- Component Registry Tests -->
        <div class="test-section">
            <h2 class="test-title">Component Registry System</h2>
            <div id="registry-tests"></div>
            <div id="registry-stats" class="stats-grid"></div>
        </div>
        
        <!-- Event Delegation Tests -->
        <div class="test-section">
            <h2 class="test-title">Event Delegation System</h2>
            <div id="event-tests"></div>
            <div id="event-stats" class="stats-grid"></div>
        </div>
        
        <!-- BaseComponent Tests -->
        <div class="test-section">
            <h2 class="test-title">Enhanced BaseComponent</h2>
            <div id="component-tests"></div>
            <div id="component-demo" class="demo-grid"></div>
        </div>
        
        <!-- Router Tests -->
        <div class="test-section">
            <h2 class="test-title">Enhanced Router System</h2>
            <div id="router-tests"></div>
            <div id="router-demo"></div>
        </div>
        
        <!-- StakingModal Tests -->
        <div class="test-section">
            <h2 class="test-title">StakingModal Component</h2>
            <div id="modal-tests"></div>
            <div id="modal-demo">
                <button id="test-staking-modal" class="btn btn-primary">Test Staking Modal</button>
            </div>
        </div>
        
        <!-- CSS Component Library Tests -->
        <div class="test-section">
            <h2 class="test-title">CSS Component Library</h2>
            <div id="css-tests"></div>
            <div id="css-demo" class="demo-grid"></div>
        </div>
        
        <!-- Responsive Design Tests -->
        <div class="test-section">
            <h2 class="test-title">Responsive Design System</h2>
            <div id="responsive-tests"></div>
            <div id="responsive-demo"></div>
        </div>
        
        <!-- Performance Tests -->
        <div class="test-section">
            <h2 class="test-title">Performance Metrics</h2>
            <div id="performance-tests"></div>
            <div id="performance-stats" class="stats-grid"></div>
        </div>
        
        <!-- Overall Results -->
        <div class="test-section">
            <h2 class="test-title">Overall Test Results</h2>
            <div id="overall-results"></div>
        </div>
    </div>

    <!-- Core JavaScript Files -->
    <script src="config/constants.js"></script>
    <script src="js/utils/helpers.js"></script>
    
    <!-- Core Classes -->
    <script src="js/core/error-handler.js"></script>
    <script src="js/core/state-manager.js"></script>
    <script src="js/core/event-manager.js"></script>
    <script src="js/core/component-registry.js"></script>
    <script src="js/core/event-delegation.js"></script>
    <script src="js/core/router.js"></script>
    
    <!-- Components -->
    <script src="js/components/base-component.js"></script>
    <script src="js/components/notification.js"></script>
    <script src="js/components/modal.js"></script>
    <script src="js/components/staking-modal.js"></script>
    
    <!-- Test Script -->
    <script>
        class Day3ValidationTest {
            constructor() {
                this.testResults = [];
                this.passedTests = 0;
                this.totalTests = 0;
                
                this.runAllTests();
            }
            
            async runAllTests() {
                console.log('🚀 Starting Day 3 Implementation Validation Tests...');
                
                await this.testComponentRegistry();
                await this.testEventDelegation();
                await this.testBaseComponent();
                await this.testRouter();
                await this.testStakingModal();
                await this.testCSSLibrary();
                await this.testResponsiveDesign();
                await this.testPerformance();
                
                this.displayOverallResults();
                
                console.log('✅ All tests completed!');
            }
            
            test(name, condition, message = '') {
                this.totalTests++;
                const passed = Boolean(condition);
                
                if (passed) {
                    this.passedTests++;
                }
                
                this.testResults.push({
                    name,
                    passed,
                    message: message || (passed ? 'Test passed' : 'Test failed')
                });
                
                return passed;
            }
            
            displayResult(containerId, testName, passed, message) {
                const container = document.getElementById(containerId);
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
                resultDiv.innerHTML = `<strong>${testName}:</strong> ${message}`;
                container.appendChild(resultDiv);
            }
            
            displayStats(containerId, stats) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                
                for (const [label, value] of Object.entries(stats)) {
                    const statCard = document.createElement('div');
                    statCard.className = 'stat-card';
                    statCard.innerHTML = `
                        <div class="stat-value">${value}</div>
                        <div class="stat-label">${label}</div>
                    `;
                    container.appendChild(statCard);
                }
            }
            
            async testComponentRegistry() {
                console.log('Testing Component Registry...');
                
                // Test registry existence
                const registryExists = this.test(
                    'Registry Exists',
                    window.componentRegistry instanceof ComponentRegistry,
                    'ComponentRegistry instance is available globally'
                );
                this.displayResult('registry-tests', 'Registry Exists', registryExists, 
                    registryExists ? 'ComponentRegistry is properly initialized' : 'ComponentRegistry not found');
                
                // Test component registration
                const testComponent = { constructor: { name: 'TestComponent' } };
                const registrationId = window.componentRegistry.register(testComponent);
                const registrationWorks = this.test(
                    'Component Registration',
                    registrationId && typeof registrationId === 'string',
                    'Component registration returns valid ID'
                );
                this.displayResult('registry-tests', 'Component Registration', registrationWorks,
                    registrationWorks ? `Component registered with ID: ${registrationId}` : 'Registration failed');
                
                // Test component retrieval
                const retrievedComponent = window.componentRegistry.get(registrationId);
                const retrievalWorks = this.test(
                    'Component Retrieval',
                    retrievedComponent === testComponent,
                    'Registered component can be retrieved'
                );
                this.displayResult('registry-tests', 'Component Retrieval', retrievalWorks,
                    retrievalWorks ? 'Component successfully retrieved' : 'Component retrieval failed');
                
                // Display registry statistics
                const stats = window.componentRegistry.getStatistics();
                this.displayStats('registry-stats', {
                    'Total Components': stats.totalComponents,
                    'Active Components': stats.activeComponents,
                    'Component Types': Object.keys(stats.componentsByType).length,
                    'Total Errors': stats.totalErrors
                });
            }
            
            async testEventDelegation() {
                console.log('Testing Event Delegation...');
                
                // Test delegation system existence
                const delegationExists = this.test(
                    'Delegation Exists',
                    window.eventDelegation instanceof EventDelegation,
                    'EventDelegation instance is available globally'
                );
                this.displayResult('event-tests', 'Delegation Exists', delegationExists,
                    delegationExists ? 'EventDelegation is properly initialized' : 'EventDelegation not found');
                
                // Test event delegation
                let delegatedEventFired = false;
                const handlerId = window.eventDelegation.delegate('click', '.test-delegate', () => {
                    delegatedEventFired = true;
                });
                
                const delegationWorks = this.test(
                    'Event Delegation',
                    handlerId && typeof handlerId === 'string',
                    'Event delegation returns valid handler ID'
                );
                this.displayResult('event-tests', 'Event Delegation', delegationWorks,
                    delegationWorks ? `Event delegated with ID: ${handlerId}` : 'Event delegation failed');
                
                // Display delegation statistics
                const stats = window.eventDelegation.getStatistics();
                this.displayStats('event-stats', {
                    'Delegated Events': stats.delegatedEventCount,
                    'Direct Events': stats.directEventCount,
                    'Handler Executions': stats.handlerExecutions,
                    'Event Types': stats.delegatedEventTypes
                });
            }

            async testBaseComponent() {
                console.log('Testing BaseComponent...');

                // Test BaseComponent class existence
                const baseComponentExists = this.test(
                    'BaseComponent Exists',
                    typeof BaseComponent === 'function',
                    'BaseComponent class is available'
                );
                this.displayResult('component-tests', 'BaseComponent Exists', baseComponentExists,
                    baseComponentExists ? 'BaseComponent class is properly defined' : 'BaseComponent class not found');

                // Test component creation
                try {
                    const testComponent = new BaseComponent();
                    const componentCreated = this.test(
                        'Component Creation',
                        testComponent instanceof BaseComponent,
                        'BaseComponent can be instantiated'
                    );
                    this.displayResult('component-tests', 'Component Creation', componentCreated,
                        componentCreated ? 'BaseComponent successfully instantiated' : 'Component creation failed');

                    // Test lifecycle methods
                    const hasLifecycleMethods = this.test(
                        'Lifecycle Methods',
                        typeof testComponent.componentDidMount === 'function' &&
                        typeof testComponent.componentWillUnmount === 'function' &&
                        typeof testComponent.setState === 'function',
                        'Component has React-like lifecycle methods'
                    );
                    this.displayResult('component-tests', 'Lifecycle Methods', hasLifecycleMethods,
                        hasLifecycleMethods ? 'All lifecycle methods are present' : 'Missing lifecycle methods');

                    testComponent.destroy();
                } catch (error) {
                    this.displayResult('component-tests', 'Component Creation', false, `Error: ${error.message}`);
                }
            }

            async testRouter() {
                console.log('Testing Router...');

                // Test Router class existence
                const routerExists = this.test(
                    'Router Exists',
                    typeof Router === 'function',
                    'Router class is available'
                );
                this.displayResult('router-tests', 'Router Exists', routerExists,
                    routerExists ? 'Router class is properly defined' : 'Router class not found');

                // Test router features
                if (routerExists) {
                    try {
                        const router = new Router();

                        const hasEnhancedFeatures = this.test(
                            'Enhanced Features',
                            typeof router.beforeEach === 'function' &&
                            typeof router.navigate === 'function' &&
                            typeof router.back === 'function',
                            'Router has enhanced navigation features'
                        );
                        this.displayResult('router-tests', 'Enhanced Features', hasEnhancedFeatures,
                            hasEnhancedFeatures ? 'All enhanced features are present' : 'Missing enhanced features');

                        router.destroy();
                    } catch (error) {
                        this.displayResult('router-tests', 'Router Creation', false, `Error: ${error.message}`);
                    }
                }
            }

            async testStakingModal() {
                console.log('Testing StakingModal...');

                // Test StakingModal class existence
                const modalExists = this.test(
                    'StakingModal Exists',
                    typeof StakingModal === 'function',
                    'StakingModal class is available'
                );
                this.displayResult('modal-tests', 'StakingModal Exists', modalExists,
                    modalExists ? 'StakingModal class is properly defined' : 'StakingModal class not found');

                if (modalExists) {
                    try {
                        const modal = new StakingModal();

                        const hasRequiredMethods = this.test(
                            'Required Methods',
                            typeof modal.show === 'function' &&
                            typeof modal.hide === 'function' &&
                            typeof modal.render === 'function',
                            'StakingModal has required methods'
                        );
                        this.displayResult('modal-tests', 'Required Methods', hasRequiredMethods,
                            hasRequiredMethods ? 'All required methods are present' : 'Missing required methods');

                        // Set up test button
                        document.getElementById('test-staking-modal').addEventListener('click', () => {
                            const mockPair = {
                                pairName: 'TEST/USDC',
                                lpToken: '0x123...',
                                weight: 100
                            };
                            modal.show(mockPair);
                        });

                        modal.destroy();
                    } catch (error) {
                        this.displayResult('modal-tests', 'Modal Creation', false, `Error: ${error.message}`);
                    }
                }
            }

            async testCSSLibrary() {
                console.log('Testing CSS Component Library...');

                // Test CSS classes availability
                const testElement = document.createElement('div');
                document.body.appendChild(testElement);

                // Test button classes
                testElement.className = 'btn btn-primary';
                const buttonStyles = window.getComputedStyle(testElement);
                const buttonClassWorks = this.test(
                    'Button Classes',
                    buttonStyles.display === 'inline-flex',
                    'Button CSS classes are properly applied'
                );
                this.displayResult('css-tests', 'Button Classes', buttonClassWorks,
                    buttonClassWorks ? 'Button styles are working' : 'Button styles not applied');

                // Test grid system
                testElement.className = 'row';
                const gridStyles = window.getComputedStyle(testElement);
                const gridClassWorks = this.test(
                    'Grid System',
                    gridStyles.display === 'flex',
                    'Grid system CSS classes are properly applied'
                );
                this.displayResult('css-tests', 'Grid System', gridClassWorks,
                    gridClassWorks ? 'Grid system is working' : 'Grid system not applied');

                // Create demo components
                const demoContainer = document.getElementById('css-demo');
                demoContainer.innerHTML = `
                    <div class="demo-card">
                        <h4>Button Variants</h4>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-primary">Primary</button>
                            <button class="btn btn-secondary">Secondary</button>
                            <button class="btn btn-success">Success</button>
                            <button class="btn btn-warning">Warning</button>
                            <button class="btn btn-danger">Danger</button>
                        </div>
                    </div>
                    <div class="demo-card">
                        <h4>Form Components</h4>
                        <div class="form-group">
                            <label class="form-label">Test Input</label>
                            <input type="text" class="form-control" placeholder="Enter text...">
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="testCheck">
                            <label class="form-check-label" for="testCheck">Test Checkbox</label>
                        </div>
                    </div>
                    <div class="demo-card">
                        <h4>Badges & Alerts</h4>
                        <div class="mb-3">
                            <span class="badge badge-primary me-2">Primary</span>
                            <span class="badge badge-success me-2">Success</span>
                            <span class="badge badge-warning">Warning</span>
                        </div>
                        <div class="alert alert-info">
                            <strong>Info:</strong> This is an info alert.
                        </div>
                    </div>
                `;

                document.body.removeChild(testElement);
            }

            async testResponsiveDesign() {
                console.log('Testing Responsive Design...');

                // Test responsive utilities
                const testElement = document.createElement('div');
                testElement.className = 'd-none d-md-block';
                document.body.appendChild(testElement);

                const responsiveStyles = window.getComputedStyle(testElement);
                const responsiveWorks = this.test(
                    'Responsive Utilities',
                    responsiveStyles.display === 'none',
                    'Responsive utility classes are working'
                );
                this.displayResult('responsive-tests', 'Responsive Utilities', responsiveWorks,
                    responsiveWorks ? 'Responsive utilities are working' : 'Responsive utilities not applied');

                // Test breakpoint system
                const breakpointVars = [
                    '--breakpoint-sm',
                    '--breakpoint-md',
                    '--breakpoint-lg',
                    '--breakpoint-xl'
                ];

                const rootStyles = window.getComputedStyle(document.documentElement);
                const breakpointsExist = breakpointVars.every(bp =>
                    rootStyles.getPropertyValue(bp).trim() !== ''
                );

                const breakpointTest = this.test(
                    'Breakpoint Variables',
                    breakpointsExist,
                    'CSS breakpoint variables are defined'
                );
                this.displayResult('responsive-tests', 'Breakpoint Variables', breakpointTest,
                    breakpointTest ? 'All breakpoint variables are defined' : 'Missing breakpoint variables');

                document.body.removeChild(testElement);
            }

            async testPerformance() {
                console.log('Testing Performance...');

                const startTime = performance.now();

                // Test component creation performance
                const components = [];
                for (let i = 0; i < 100; i++) {
                    components.push(new BaseComponent());
                }

                const creationTime = performance.now() - startTime;
                const performanceTest = this.test(
                    'Component Creation Performance',
                    creationTime < 1000,
                    'Component creation is performant'
                );
                this.displayResult('performance-tests', 'Component Creation Performance', performanceTest,
                    `Created 100 components in ${creationTime.toFixed(2)}ms`);

                // Clean up test components
                components.forEach(comp => comp.destroy());

                // Display performance stats
                const registryStats = window.componentRegistry.getStatistics();
                const eventStats = window.eventDelegation.getStatistics();

                this.displayStats('performance-stats', {
                    'Component Creation Time': `${creationTime.toFixed(2)}ms`,
                    'Registry Components': registryStats.totalComponents,
                    'Event Handlers': eventStats.delegatedEventCount + eventStats.directEventCount,
                    'Memory Usage': registryStats.memoryUsage ?
                        `${(registryStats.memoryUsage.used / 1024 / 1024).toFixed(2)}MB` : 'N/A'
                });
            }

            displayOverallResults() {
                const container = document.getElementById('overall-results');
                const successRate = ((this.passedTests / this.totalTests) * 100).toFixed(1);

                container.innerHTML = `
                    <div class="test-result ${this.passedTests === this.totalTests ? 'test-pass' : 'test-info'}">
                        <h3>Test Summary</h3>
                        <p><strong>Passed:</strong> ${this.passedTests} / ${this.totalTests} tests</p>
                        <p><strong>Success Rate:</strong> ${successRate}%</p>
                        <p><strong>Status:</strong> ${this.passedTests === this.totalTests ?
                            '✅ All tests passed! Day 3 implementation is complete.' :
                            '⚠️ Some tests failed. Review the results above.'}</p>
                    </div>
                `;

                // Log results to console
                console.log(`🎯 Test Results: ${this.passedTests}/${this.totalTests} passed (${successRate}%)`);
                this.testResults.forEach(result => {
                    console.log(`${result.passed ? '✅' : '❌'} ${result.name}: ${result.message}`);
                });
            }
        }

        // Start tests when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new Day3ValidationTest();
        });
    </script>
</body>
</html>
